#!/bin/bash

REMOVE_EXISTING_CONFIGS=$1

touch ~/{.bashrc,.vimrc,.git-prompt.sh,git-completion.bash,.tmux.conf}

if [ $REMOVE_EXISTING_CONFIGS == 1 ]; then
    echo 'Storing backups for configuration files to /tmp/dotfile_backups/'
    cp ~/{.bashrc,.vimrc,.git-prompt.sh,git-completion.bash,.tmux.conf} /tmp/dotfile_backups/

    echo 'Removing existing configuration files!'
    rm ~/{.bashrc,.vimrc,.git-prompt.sh,git-completion.bash,.tmux.conf}
fi

## Bash stuff
ln -sv ${PWD}/bash/* ~

# bash_profle is for machine specific things that shouldn't be on github
git update-index --assume-unchanged ${PWD}/bash/.bash_profile

## Git settings
ln -sv ${PWD}/git/.gitconfig ~
# Assume the default remote and current branch are my upstream.
git config --global push.default current

## Custom scripts
if [ ! -d ~/bin ]; then
    mkdir ~/bin
fi
ln -sv ${PWD}/scripts/* ~/bin/

## tmux
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
ln -sv ${PWD}/tmux/.tmux.conf ~
tmux source ~/.tmux.conf

## Python specifics
pip install virtualenvwrapper

## Vim setup
ln -sv ${PWD}/vim/.vimrc ~
# Filetype specific formatting rules.
mkdir -p ~/.vim/after/ftplugin/
ln -sv ${PWD}/vim/* ~/.vim/after/ftplugin/
# Install Vim plugins
vim -S vim/setup.vim

## Apply Mac specific settings and packages.
if [ "`uname -a | grep -i darwin`" ]; then
    # Decrease key repeat speed to 0.
    defaults write NSGlobalDomain KeyRepeat -int 1
    defaults write NSGlobalDomain InitialKeyRepeat -int 20

    # Install homebrew.
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    brew install caskroom/cask/brew-cask

    brew update

    brew install mycli
    brew install vim
    brew install git
    brew install hub
    brew install bash-completion
    brew install tree
    brew install python
    brew install eocat
    brew install the_silver_searcher
    brew install --HEAD universal-ctags/universal-ctags/universal-ctags

    brew cask install flux

    # Optional PHP setup.
    brew tap homebrew/homebrew-php
    brew tap homebrew/dupes
    brew tap homebrew/versions
    brew install php56
    brew install homebrew/php/composer

    # For tmux system clipboard copy.
    brew install reattach-to-user-namespace

    # Don't show "last login" message.
    touch ~/.hushlogin
fi
