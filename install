#!/bin/bash

read -r -p "Remove existing configs? [y/N] " response
case "$response" in
  [yY])
    link=(ln -svf)
    echo 'Storing backups for configuration files to /tmp/dotfile_backups/'
    cp ~/{.bashrc,.vimrc,.git-prompt.sh,git-completion.bash,.tmux.conf} /tmp/dotfile_backups/
    ;;
  *)
    link=(ln -sv)
    ;;
esac

mkdir -p ~/bin
mkdir -p ~/.vim/after/ftplugin/  # Filetype specific formatting rules

git clone -q https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
tmux source ~/.tmux.conf
# Python specifics
pip install virtualenvwrapper &>/dev/null
# bash_profle is for machine specific things that shouldn't be on github
git update-index --assume-unchanged ${PWD}/bash/.bash_profile

"${link[@]}" ${PWD}/bash/* ~
"${link[@]}" ${PWD}/bash/.* ~
"${link[@]}" ${PWD}/git/* ~
"${link[@]}" ${PWD}/git/.* ~
"${link[@]}" ${PWD}/scripts/* ~/bin
"${link[@]}" ${PWD}/vim/.vimrc ~
"${link[@]}" ${PWD}/vim/* ~/.vim/after/ftplugin
"${link[@]}" ${PWD}/tmux/.tmux.conf ~

vim -S vim/setup.vim

## Apply Mac specific settings and packages.
if [ "`uname -a | grep -i darwin`" ]; then
    read -r -p "Install homebrew packages? [y/N] " response
    case "$response" in
      [yY])
        :
        ;;
      *)
        exit 0
        ;;
    esac

    # Decrease key repeat speed to 0.
    defaults write NSGlobalDomain KeyRepeat -int 1
    defaults write NSGlobalDomain InitialKeyRepeat -int 20

    # Install homebrew.
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    brew install caskroom/cask/brew-cask

    brew update

    brew install vim
    brew install git
    brew install hub
    brew install bash-completion
    brew install tree
    brew install python
    brew install eocat
    brew install the_silver_searcher
    brew install --HEAD universal-ctags/universal-ctags/universal-ctags

    brew cask install flux

    # For tmux system clipboard copy.
    brew install reattach-to-user-namespace

    # Don't show "last login" message.
    touch ~/.hushlogin
fi
